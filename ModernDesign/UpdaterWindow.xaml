<Window
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:shell="http://schemas.microsoft.com/netfx/2009/xaml/presentation"
        xmlns:av="http://schemas.microsoft.com/expression/blend/2008" 
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        mc:Ignorable="av" 
        x:Class="ModernDesign.MVVM.View.UpdaterWindow"
        Title="Leuan | DLC Updater" 
        MinHeight="650" MinWidth="800"
        Height="600" Width="700"
        WindowStyle="None"
        ResizeMode="CanResize"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStartupLocation="CenterScreen" 
        Icon="/Icono_TLK.ico">

    <!-- NUEVO: TaskbarItemInfo para mostrar progreso en la barra de tareas -->
    <Window.TaskbarItemInfo>
        <TaskbarItemInfo x:Name="TaskbarInfo" ProgressState="None" ProgressValue="0"/>
    </Window.TaskbarItemInfo>
    
    <Window.Resources>
        <!-- CheckBox Style -->
        <Style x:Key="DLCCheckBox" TargetType="CheckBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <Border x:Name="bg" Background="#15FFFFFF" CornerRadius="8" Padding="10" Margin="0,3">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="50"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Custom Checkbox -->
                                <Border x:Name="check" Grid.Column="0" Width="20" Height="20" 
                                        CornerRadius="5" BorderBrush="#3EC7E8" BorderThickness="2"
                                        Background="Transparent" VerticalAlignment="Center">
                                    <TextBlock x:Name="checkMark" Text="✓" Foreground="#3EC7E8" 
                                               FontWeight="Bold" FontSize="12" HorizontalAlignment="Center" 
                                               VerticalAlignment="Center" Visibility="Collapsed"/>
                                </Border>

                                <!-- Image -->
                                <Border Grid.Column="1" Width="45" Height="45" CornerRadius="6" 
                                        Margin="10,0,0,0" Background="#20FFFFFF">
                                    <Image Stretch="UniformToFill"
                                           RenderOptions.BitmapScalingMode="HighQuality"
                                           Source="{Binding RelativeSource={RelativeSource TemplatedParent},
                                                            Path=DataContext.ImageUrl}"/>
                                </Border>

                                <!-- Text -->
                                <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="12,0,0,0">
                                    <ContentPresenter/>
                                    <TextBlock Text="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ToolTip}" 
                                               Foreground="#94A3B8" FontSize="10" Margin="0,2,0,0" TextWrapping="Wrap"/>
                                </StackPanel>

                                <!-- Info Button -->
                                <Button Grid.Column="3"
                                        Width="24" Height="24"
                                        Margin="8,0,0,0"
                                        Background="#20FFFFFF"
                                        BorderThickness="0"
                                        Cursor="Hand"
                                        Click="InfoButton_Click">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="infoBg" CornerRadius="999" Background="#20FFFFFF" Padding="3">
                                                <TextBlock Text="?" 
                                                           FontWeight="Bold" 
                                                           FontSize="11"
                                                           Foreground="#3EC7E8"
                                                           HorizontalAlignment="Center" 
                                                           VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="infoBg" Property="Background" Value="#40FFFFFF"/>
                                                </Trigger>
                                                <Trigger Property="IsEnabled" Value="False">
                                                    <Setter TargetName="infoBg" Property="Opacity" Value="0.4"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="check" Property="Background" Value="#3EC7E8"/>
                                <Setter TargetName="checkMark" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="checkMark" Property="Foreground" Value="#0F172A"/>
                                <Setter TargetName="bg" Property="Background" Value="#25FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bg" Property="Background" Value="#20FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="bg" Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Primary Button Style -->
        <Style x:Key="ActionButton" TargetType="{x:Type Button}">
            <Setter Property="Background" Value="#0A6BF2"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border x:Name="bg" Background="{TemplateBinding Background}" 
                                CornerRadius="8" Padding="15,10">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bg" Property="Background" Value="#3EC7E8"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="bg" Property="Background" Value="#404040"/>
                                <Setter Property="Foreground" Value="#808080"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Secondary Button Style -->
        <Style x:Key="SecondaryButton" TargetType="{x:Type Button}" BasedOn="{StaticResource ActionButton}">
            <Setter Property="Background" Value="#30FFFFFF"/>
        </Style>
    </Window.Resources>

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="40" ResizeBorderThickness="6" 
                      CornerRadius="0" GlassFrameThickness="0" UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>

    <Border CornerRadius="12">
        <Border.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#0F172A" Offset="0"/>
                <GradientStop Color="#1E293B" Offset="1"/>
            </LinearGradientBrush>
        </Border.Background>
        <Border.Effect>
            <DropShadowEffect BlurRadius="30" ShadowDepth="0" Opacity="0.5"/>
        </Border.Effect>

        <Grid Margin="8">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*" MinHeight="150"/>
                <RowDefinition Height="Auto" MinHeight="120"/>
            </Grid.RowDefinitions>

            <!-- HEADER -->
            <Border Grid.Row="0" Padding="8,5">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center"
                                WindowChrome.IsHitTestVisibleInChrome="True" HorizontalAlignment="Left">
                        <Button x:Name="BackBtn" Width="32" Height="32"
                                Background="Transparent" Foreground="White" 
                                BorderThickness="0" Cursor="Hand"
                                Click="BackBtn_Click" ToolTip="Back to main menu">
                            <Button.Template>
                                <ControlTemplate TargetType="{x:Type Button}">
                                    <Border x:Name="bg" Background="Transparent" CornerRadius="6" Padding="6">
                                        <TextBlock Text="←" FontSize="16" FontWeight="Bold"
                                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="bg" Property="Background" Value="#20FFFFFF"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                        <TextBlock Text="🎮  DLC Updater" Foreground="White" FontSize="14" 
                                   FontWeight="SemiBold" VerticalAlignment="Center" Margin="6,0,0,0"/>
                    </StackPanel>

                    <Button x:Name="TutorialBtn" Content="🔍 Tutorial" 
                            HorizontalAlignment="Right"
                            Style="{StaticResource SecondaryButton}" 
                            Click="TutorialBtn_Click"
                            Padding="10,6"
                            FontSize="11"
                            WindowChrome.IsHitTestVisibleInChrome="True"/>
                </Grid>
            </Border>

            <!-- PATH SELECTOR -->
            <Border Grid.Row="1" Margin="8,4" Padding="12,10" CornerRadius="10" Background="#10FFFFFF">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="📁" FontSize="14" VerticalAlignment="Center"/>
                        <TextBlock Text="The Sims 4 install location" Foreground="White" FontSize="12" 
                                   FontWeight="SemiBold" VerticalAlignment="Center" Margin="6,0,0,0"/>
                        <TextBlock x:Name="StatusText" Text="  (Searching...)" 
                                   Foreground="#F59E0B" FontSize="10" VerticalAlignment="Center"/>
                    </StackPanel>

                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Background="#15FFFFFF" CornerRadius="6" Padding="8,6">
                            <TextBlock x:Name="PathTextBlock" Text="Select The Sims 4 install folder..." 
                                       Foreground="#94A3B8" FontSize="11" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                        </Border>

                        <Button x:Name="BrowseBtn" Grid.Column="1" Content="Browse" Margin="6,0,0,0"
                                Style="{StaticResource SecondaryButton}" Click="BrowseBtn_Click"
                                Padding="10,6" FontSize="11"
                                WindowChrome.IsHitTestVisibleInChrome="True"/>

                        <Button x:Name="AutoDetectBtn" Grid.Column="2" Content="🔍 Auto" Margin="6,0,0,0"
                                Style="{StaticResource SecondaryButton}" Click="AutoDetectBtn_Click"
                                Padding="10,6" FontSize="11"
                                WindowChrome.IsHitTestVisibleInChrome="True"/>
                    </Grid>
                </Grid>
            </Border>

            <!-- SEARCH BAR -->
            <Border Grid.Row="2" Margin="8,4" Padding="12,10" CornerRadius="10" Background="#10FFFFFF">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" Background="#15FFFFFF" CornerRadius="6" Padding="8,6">
                        <Grid>
                            <TextBlock x:Name="SearchPlaceholder" 
                                       Text="🔍 Search DLCs by name, code, or description..." 
                                       Foreground="#64748B" 
                                       FontSize="11"
                                       VerticalAlignment="Center"
                                       IsHitTestVisible="False"/>
                            <TextBox x:Name="SearchBox"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Foreground="White"
                                     FontSize="11"
                                     VerticalAlignment="Center"
                                     TextChanged="SearchBox_TextChanged"/>
                        </Grid>
                    </Border>

                    <Button x:Name="ClearSearchBtn" Grid.Column="1" Content="✕ Clear" Margin="6,0,0,0"
                            Style="{StaticResource SecondaryButton}" 
                            Click="ClearSearchBtn_Click"
                            Padding="10,6"
                            FontSize="11"
                            WindowChrome.IsHitTestVisibleInChrome="True"/>
                </Grid>
            </Border>

            <!-- DLC LIST -->
            <Border Grid.Row="3" Margin="8,4" CornerRadius="10" Background="#08FFFFFF">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- List header -->
                    <Border Grid.Row="0" Padding="10,8" Background="#10FFFFFF" CornerRadius="10,10,0,0">
                        <Grid>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="📦 Available DLCs" Foreground="White" FontSize="12" 
                                           FontWeight="SemiBold" VerticalAlignment="Center"/>
                                <TextBlock x:Name="CountText" Text=" (0 selected)" Foreground="#94A3B8" 
                                           FontSize="10" VerticalAlignment="Center"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right"
                                        WindowChrome.IsHitTestVisibleInChrome="True">
                                <Button x:Name="SelectAllBtn" Content="Select All" FontSize="10"
                                        Style="{StaticResource SecondaryButton}" Padding="8,5"
                                        Click="SelectAllBtn_Click" IsEnabled="False"/>
                                <Button x:Name="DeselectAllBtn" Content="Deselect All" FontSize="10"
                                        Style="{StaticResource SecondaryButton}" Padding="8,5" Margin="5,0,0,0"
                                        Click="DeselectAllBtn_Click" IsEnabled="False"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Scrollable list -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="10,6"
                                  WindowChrome.IsHitTestVisibleInChrome="True">
                        <StackPanel x:Name="DLCList"/>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- FOOTER -->
            <Border Grid.Row="4" Margin="8,4">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*" MinHeight="50"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- DLC Unlocker status -->
                    <TextBlock x:Name="UnlockerStatusText"
                               Grid.Row="0"
                               Text="DLC Unlocker: Checking..."
                               Foreground="#E5E7EB"
                               FontSize="10"
                               Margin="0,0,0,4"/>

                    <!-- Total Value of Installed DLCs -->
                    <TextBlock x:Name="TotalValueText"
                       Grid.Row="0"
                       Text="💰 Your game is worth: $0.00 USD"
                       Foreground="#22C55E"
                       FontSize="10"
                       FontWeight="SemiBold"
                       HorizontalAlignment="Right"
                       Margin="0,0,0,4"/>

                    <!-- Progress bar - Goku Kamehameha Style -->
                    <StackPanel x:Name="ProgressPanel" Grid.Row="1" Visibility="Collapsed" Margin="0,0,0,4">
                        <Grid>
                            <TextBlock x:Name="ProgressText" Text="Downloading..." Foreground="White" FontSize="10"/>
                            <TextBlock x:Name="ProgressPercent" Text="0%" Foreground="#3EC7E8" 
                   FontSize="10" HorizontalAlignment="Right"/>
                        </Grid>

                        <!-- Goku Kamehameha Progress Bar -->
                        <Grid Height="60" Margin="0,4,0,0">
                            <!-- Goku Image (Fixed position on the left) -->
                            <Image x:Name="GokuImage" 
               Source="{Binding GokuPoseImagePath}"
               Width="50" 
               Height="50"
               HorizontalAlignment="Left"
               VerticalAlignment="Center"
               Margin="5,0,0,0"
               RenderOptions.BitmapScalingMode="HighQuality"/>

                            <!-- Kamehameha Beam (Grows with progress) -->
                            <Image x:Name="KamehamehaBeam"
               Source="{Binding KamehamehaGifPath}"
               Height="40"
               HorizontalAlignment="Left"
               VerticalAlignment="Center"
               Margin="55,0,0,0"
               Width="0"
               Stretch="Fill"
               RenderOptions.BitmapScalingMode="HighQuality"/>
                        </Grid>

                        <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                            <TextBlock Text="Speed:" Foreground="#94A3B8" FontSize="9"/>
                            <TextBlock x:Name="SpeedText" Text="0 MB/s" Foreground="#E5E7EB" FontSize="9" Margin="3,0,8,0"/>

                            <TextBlock Text="ETA:" Foreground="#94A3B8" FontSize="9"/>
                            <TextBlock x:Name="EtaText" Text="--:--" Foreground="#E5E7EB" FontSize="9" Margin="3,0,8,0"/>

                            <TextBlock Text="Installed:" Foreground="#94A3B8" FontSize="9"/>
                            <TextBlock x:Name="InstalledCountText" Text="0/0" Foreground="#E5E7EB" FontSize="9" Margin="3,0,0,0"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- LOG -->
                    <Border Grid.Row="2" Background="#10FFFFFF" CornerRadius="6" Padding="6">
                        <TextBox x:Name="LogTextBox"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 Foreground="#E5E7EB"
                                 FontSize="9"
                                 IsReadOnly="True"
                                 TextWrapping="Wrap"
                                 VerticalScrollBarVisibility="Auto"/>
                    </Border>

                    <!-- Download Button -->
                    <!-- Action Buttons -->
                    <!-- Action Buttons -->
                    <Grid Grid.Row="3" Margin="0,6,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="10"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Download/Uninstall Buttons (Visible when NOT downloading) -->
                        <Button x:Name="DownloadBtn" Grid.Column="0" Content="⬇️  Download Selected" 
            Height="40" FontSize="13" Style="{StaticResource ActionButton}" 
            Click="DownloadBtn_Click" IsEnabled="False"
            WindowChrome.IsHitTestVisibleInChrome="True"/>

                        <Button x:Name="UninstallBtn" Grid.Column="2" Content="🗑️  Uninstall Selected" 
            Height="40" FontSize="13" Style="{StaticResource SecondaryButton}" 
            Click="UninstallBtn_Click" IsEnabled="False"
            WindowChrome.IsHitTestVisibleInChrome="True"/>

                        <!-- Pause/Cancel Buttons (Visible ONLY when downloading) -->
                        <Button x:Name="PauseBtn" Grid.Column="0" Content="⏸️  Pause" 
            Height="40" FontSize="13" Style="{StaticResource SecondaryButton}" 
            Click="PauseBtn_Click" Visibility="Collapsed"
            WindowChrome.IsHitTestVisibleInChrome="True"/>

                        <Button x:Name="CancelBtn" Grid.Column="2" Content="❌  Cancel" 
            Height="40" FontSize="13" 
            Background="#EF4444"
            Foreground="White"
            FontWeight="SemiBold"
            Cursor="Hand"
            Click="CancelBtn_Click" Visibility="Collapsed"
            WindowChrome.IsHitTestVisibleInChrome="True">
                            <Button.Template>
                                <ControlTemplate TargetType="{x:Type Button}">
                                    <Border x:Name="bg" Background="{TemplateBinding Background}" 
                        CornerRadius="8" Padding="15,10">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="bg" Property="Background" Value="#DC2626"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>